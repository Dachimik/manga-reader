<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Web Manga — Kiryuu-like Reader for GitHub</title>
<meta name="description" content="Static manga reader for GitHub Pages — easy to host, lazy-loading, keyboard & mobile friendly">
<style>
:root{--bg:#f6f7fb;--card:#fff;--muted:#667;--accent:#7c5cff}
[data-theme="dark"]{--bg:#0b0c10;--card:#0f1116;--muted:#aab;--accent:#8ea8ff}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--bg);color:var(--muted)}
header{display:flex;align-items:center;gap:12px;padding:14px 18px;background:linear-gradient(0deg,rgba(0,0,0,0.03),transparent);position:sticky;top:0;backdrop-filter:blur(6px);z-index:50}
.logo{font-weight:700;color:var(--accent)}
.search{flex:1;max-width:720px}
input[type=search]{width:100%;padding:8px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);background:var(--card)}
.controls{display:flex;gap:8px}
button{background:var(--card);border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:8px;cursor:pointer}
main{padding:18px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px}
.card{background:var(--card);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:8px}
.cover{width:100%;aspect-ratio:2/3;object-fit:cover;border-radius:8px}
.title{font-weight:600;color:inherit}
.meta{font-size:12px;color:var(--muted)}
.reader{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column}
.reader .topbar{display:flex;align-items:center;gap:8px;padding:10px;background:linear-gradient(0deg,rgba(0,0,0,0.04),transparent)}
.reader .pages{flex:1;display:flex;align-items:center;justify-content:center;overflow:auto;padding:18px}
.reader img{max-width:100%;height:auto;display:block;margin:0 auto;user-select:none}
.navbtn{position:fixed;top:50%;transform:translateY(-50%);background:transparent;border:none;font-size:28px;padding:10px;cursor:pointer}
.navbtn.left{left:6px}
.navbtn.right{right:6px}
.thumbs{display:flex;gap:8px;overflow:auto;padding:8px}
.thumbs img{width:80px;height:110px;object-fit:cover;border-radius:6px;opacity:0.8}
footer{padding:18px;text-align:center;color:var(--muted)}
@media (max-width:600px){.grid{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
<header>
<div class="logo">MangaHub</div>
<div class="search"><input id="search" type="search" placeholder="Cari judul... (contoh: one piece)"></div>
<div class="controls">
<button id="themeToggle" title="Toggle theme">Tema</button>
<button id="openBookmarks">Bookmark</button>
</div>
</header>


<main>
<section id="home">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
<h2 style="margin:0">Daftar Manga</h2>
<small id="count" style="color:var(--muted)"></small>
</div>
<div id="grid" class="grid"></div>
</section>
</main>


<div id="reader" class="reader" style="display:none" aria-hidden="true">
<div class="topbar">
<button id="closeReader">Kembali</button>
<div id="readerTitle" style="font-weight:700"></div>
<div style="flex:1"></div>
<select id="chapterSelect"></select>
<button id="bookmarkBtn">Simpan</button>
</div>
<div class="pages" id="pagesContainer" tabindex="0"></div>
<div class="thumbs" id="thumbs"></div>
<button class="navbtn left" id="prevBtn">‹</button>
<button class="navbtn right" id="nextBtn">›</button>
</div>


<footer>
Built for GitHub Pages — edit <code>catalog</code> array in the HTML to add manga.
</footer>


<script>
// ====== Manifest (edit this) ======


// Search
search.addEventListener('input', e=>{
const q = e.target.value.trim().toLowerCase();
const filtered = catalog.filter(s=>s.title.toLowerCase().includes(q) || s.id.includes(q));
renderGrid(filtered);
});


// Reader state
let current = {series:null, chapterIndex:0, pageIndex:0};
const reader = $('#reader');
const pagesContainer = $('#pagesContainer');
const thumbs = $('#thumbs');
const readerTitle = $('#readerTitle');
const chapterSelect = $('#chapterSelect');


function openReader(seriesId, chapterIdx=0, pageIdx=0){
const series = catalog.find(s=>s.id===seriesId);
if(!series) return alert('Series tidak ditemukan');
current.series = series; current.chapterIndex = chapterIdx; current.pageIndex = pageIdx;
readerTitle.textContent = series.title;
// populate chapterSelect
chapterSelect.innerHTML = '';
series.chapters.forEach((c,i)=>{const o=document.createElement('option');o.value=i;o.textContent=c.title;chapterSelect.append(o)});
chapterSelect.value = chapterIdx;
showChapter();
reader.style.display='flex'; reader.setAttribute('aria-hidden','false');
document.body.style.overflow='hidden';
}


function closeReader(){ reader.style.display='none'; reader.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
$('#closeReader').onclick=closeReader;


chapterSelect.onchange = ()=>{ current.chapterIndex = parseInt(chapterSelect.value); current.pageIndex=0; showChapter(); };


function showChapter(){
const ch = current.series.chapters[current.chapterIndex];
pagesContainer.innerHTML = '';
thumbs.innerHTML = '';
ch.pages.forEach((p,i)=>{
const img = document.createElement('img'); img.dataset.src=p; img.alt = `Page ${i+1}`; img.loading='lazy';
// placeholder, set real src when near
img.src = ''; img.style.maxWidth='100%'; img.style.marginBottom='12px';
pagesContainer.append(img);
const t = document.createElement('img'); t.src=p; t.loading='lazy'; t.onclick = ()=>goToPage(i); thumbs.append(t);
});
// lazy-load first two pages synchronously
lazyLoadAround(current.pageIndex);
updatePageHighlight();
}


function lazyLoadAround(idx){
const imgs = pagesContainer.querySelectorAll('img');
for(let i=Math.max(0,idx-1); i<Math.min(imgs.length, idx+3); i++){
const el = imgs[i]; if(el && !el.src) el.src = el.dataset.src;
}
}


function goToPage(i){
current.pageIndex = i; const imgs = pagesContainer.querySelectorAll('img');
if(imgs[i] && imgs[i].src) imgs[i].scrollIntoView({behavior:'smooth',block:'center'});
lazyLoadAround(i); updatePageHighlight(); saveBookmark();
}


function updatePageHighlight(){
const thumbsImgs = thumbs.querySelectorAll('img'); thumbsImgs.forEach((t,idx)=>t.style.opacity = (idx===current.pageIndex?1:0.6));
}


$('#prevBtn').onclick = ()=>{ if(current.pageIndex>0){goToPage(current.pageIndex-1)} else if(current.chapterIndex>0){current.chapterIndex--; current.pageIndex=0; chapterSelect.value=current.chapterIndex; showChapter();}}
$('#nextBtn').onclick = ()=>{ const len = current.series.chapters[current.chapterIndex].pages.length; if(current.pageIndex < len-1){goToPage(current.pageIndex+1)} else if(current.chapterIndex < current.series.chapters.length-1){current.chapterIndex++; current.pageIndex=0; chapterSelect.value=current.chapterIndex; showChapter();}}


// Keyboard navigation
document.addEventListener('keydown', e=>{
if(reader.style.display==='none') return;
if(e.key==='ArrowLeft') $('#prevBtn').click();
if(e.key==='ArrowRight') $('#nextBtn').click();
if(e.key==='Escape') closeReader();
});
  // Touch swipe
let startX=0; pagesContainer.addEventListener('touchstart',e=>startX=e.touches[0].clientX);
pagesContainer.addEventListener('touchend',e=>{ const dx = (e.changedTouches[0].clientX - startX); if(dx>50) $('#prevBtn').click(); if(dx<-50) $('#nextBtn').click(); });


// Bookmarking
const BOOKMARK_KEY = 'mangahub_bookmarks';
function saveBookmark(){
const saved = JSON.parse(localStorage.getItem(BOOKMARK_KEY) || '{}');
saved[current.series.id] = {chapter:current.chapterIndex,page:current.pageIndex,time:Date.now()};
localStorage.setItem(BOOKMARK_KEY, JSON.stringify(saved));
$('#bookmarkBtn').textContent='Tersimpan'; setTimeout(()=>$('#bookmarkBtn').textContent='Simpan',900);
}
$('#bookmarkBtn').onclick = saveBookmark;
$('#openBookmarks').onclick = ()=>{
const saved = JSON.parse(localStorage.getItem(BOOKMARK_KEY) || '{}');
const keys = Object.keys(saved); if(!keys.length) return alert('Belum ada bookmark');
const pick = keys.map(k=>`${k} — chap ${saved[k].chapter+1} p${saved[k].page+1}`).join('\n');
alert('Bookmarks:\n'+pick);
}


// Theme
const themeToggle = $('#themeToggle');
function applyTheme(t){ if(t==='dark') document.documentElement.setAttribute('data-theme','dark'); else document.documentElement.removeAttribute('data-theme'); localStorage.setItem('manga_theme', t); }
themeToggle.onclick = ()=>{ applyTheme(localStorage.getItem('manga_theme')==='dark' ? 'light':'dark'); }
(function(){ const t = localStorage.getItem('manga_theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark':'light'); applyTheme(t); })();


// On page scroll, detect which image is in view and update current.pageIndex
pagesContainer.addEventListener('scroll', ()=>{
const imgs = [...pagesContainer.querySelectorAll('img')];
const top = pagesContainer.scrollTop; let nearest=0; let bestDist=Infinity;
imgs.forEach((img,i)=>{ const rect = img.getBoundingClientRect(); const dist = Math.abs(rect.top + rect.height/2 - window.innerHeight/2); if(dist<bestDist){bestDist=dist; nearest=i}});
if(nearest!==undefined){ current.pageIndex = nearest; lazyLoadAround(nearest); updatePageHighlight(); }
});


// Save last reading position when closing
window.addEventListener('beforeunload', ()=>{ saveBookmark(); });


// Helper to open reader from grid (by series id)
window.openReader = openReader;


// Accessibility focus outline
pagesContainer.addEventListener('keydown', e=>{ if(e.key==='ArrowRight') $('#nextBtn').click(); if(e.key==='ArrowLeft') $('#prevBtn').click(); });


</script>
</body>
</html>
